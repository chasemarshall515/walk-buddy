<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Walk Buddy</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --sage: #8FAF8C;
    --cream: #F7F3EC;
    --bark: #3D2B1F;
    --sand: #D4C5A9;
    --sky: #7BADC4;
    --warm: #E8D5B7;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'DM Sans', sans-serif;
    background: var(--cream);
    color: var(--bark);
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* Decorative bg circles */
  body::before {
    content: '';
    position: fixed;
    top: -120px; right: -120px;
    width: 400px; height: 400px;
    border-radius: 50%;
    background: radial-gradient(circle, var(--sage) 0%, transparent 70%);
    opacity: 0.25;
    pointer-events: none;
  }
  body::after {
    content: '';
    position: fixed;
    bottom: -80px; left: -80px;
    width: 300px; height: 300px;
    border-radius: 50%;
    background: radial-gradient(circle, var(--sky) 0%, transparent 70%);
    opacity: 0.2;
    pointer-events: none;
  }

  header {
    padding: 2.5rem 2rem 1rem;
    text-align: center;
    animation: fadeDown 0.7s ease both;
  }

  .logo {
    font-family: 'DM Serif Display', serif;
    font-size: 2.8rem;
    color: var(--bark);
    letter-spacing: -0.5px;
  }
  .logo span { color: var(--sage); font-style: italic; }

  .tagline {
    font-size: 0.9rem;
    font-weight: 300;
    color: #7a6355;
    margin-top: 0.3rem;
    letter-spacing: 0.08em;
    text-transform: uppercase;
  }

  .card {
    background: white;
    border-radius: 24px;
    padding: 2rem;
    margin: 1.5rem auto;
    max-width: 480px;
    box-shadow: 0 4px 24px rgba(61,43,31,0.07);
    animation: fadeUp 0.7s ease 0.2s both;
  }

  .section-label {
    font-size: 0.75rem;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.12em;
    color: var(--sage);
    margin-bottom: 0.75rem;
  }

  /* Distance slider */
  .distance-display {
    font-family: 'DM Serif Display', serif;
    font-size: 3.5rem;
    color: var(--bark);
    line-height: 1;
    margin-bottom: 0.25rem;
  }
  .distance-display span { font-size: 1.2rem; font-family: 'DM Sans', sans-serif; font-weight: 300; color: #7a6355; }

  input[type=range] {
    -webkit-appearance: none;
    width: 100%;
    height: 6px;
    border-radius: 3px;
    background: linear-gradient(to right, var(--sage) 0%, var(--sage) var(--pct, 30%), var(--sand) var(--pct, 30%), var(--sand) 100%);
    margin: 1rem 0 0.5rem;
    outline: none;
    cursor: pointer;
  }
  input[type=range]::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 22px; height: 22px;
    border-radius: 50%;
    background: var(--bark);
    border: 3px solid white;
    box-shadow: 0 2px 8px rgba(61,43,31,0.25);
    transition: transform 0.15s;
  }
  input[type=range]::-webkit-slider-thumb:hover { transform: scale(1.15); }

  .range-labels {
    display: flex;
    justify-content: space-between;
    font-size: 0.75rem;
    color: #b0a090;
  }

  /* Preferences */
  .prefs-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-bottom: 0.5rem;
  }

  .pref-chip {
    display: flex;
    align-items: center;
    gap: 0.4rem;
    padding: 0.5rem 1rem;
    border-radius: 100px;
    border: 1.5px solid var(--sand);
    background: transparent;
    cursor: pointer;
    font-size: 0.85rem;
    font-family: 'DM Sans', sans-serif;
    color: var(--bark);
    transition: all 0.18s;
  }
  .pref-chip:hover { border-color: var(--sage); background: rgba(143,175,140,0.08); }
  .pref-chip.active {
    background: var(--bark);
    border-color: var(--bark);
    color: var(--cream);
  }
  .pref-chip .icon { font-size: 1rem; }

  .generate-btn {
    width: 100%;
    padding: 1rem;
    border-radius: 14px;
    border: none;
    background: var(--bark);
    color: var(--cream);
    font-family: 'DM Serif Display', serif;
    font-size: 1.25rem;
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    margin-top: 1.5rem;
  }
  .generate-btn:hover { background: #5a3f30; transform: translateY(-1px); box-shadow: 0 6px 20px rgba(61,43,31,0.2); }
  .generate-btn:active { transform: translateY(0); }
  .generate-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

  /* Map area */
  #map-section {
    max-width: 480px;
    margin: 0 auto 1.5rem;
    animation: fadeUp 0.5s ease both;
    display: none;
  }

  #map {
    width: 100%;
    height: 380px;
    border-radius: 20px;
    overflow: hidden;
    box-shadow: 0 4px 24px rgba(61,43,31,0.12);
  }

  .route-info {
    display: flex;
    gap: 0.75rem;
    margin-top: 0.75rem;
  }

  .info-pill {
    flex: 1;
    background: white;
    border-radius: 14px;
    padding: 0.9rem 1rem;
    text-align: center;
    box-shadow: 0 2px 12px rgba(61,43,31,0.06);
  }
  .info-pill .val {
    font-family: 'DM Serif Display', serif;
    font-size: 1.5rem;
    color: var(--bark);
  }
  .info-pill .lbl {
    font-size: 0.72rem;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: #9a8878;
    margin-top: 0.1rem;
  }

  .spots-list {
    background: white;
    border-radius: 16px;
    padding: 1.2rem;
    margin-top: 0.75rem;
    box-shadow: 0 2px 12px rgba(61,43,31,0.06);
  }
  .spots-title {
    font-size: 0.75rem;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: var(--sage);
    margin-bottom: 0.75rem;
  }
  .spot-item {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.5rem 0;
    border-bottom: 1px solid var(--warm);
    font-size: 0.9rem;
  }
  .spot-item:last-child { border-bottom: none; }
  .spot-icon {
    width: 30px; height: 30px;
    border-radius: 8px;
    background: var(--warm);
    display: flex; align-items: center; justify-content: center;
    font-size: 0.95rem;
    flex-shrink: 0;
  }
  .spot-name { font-weight: 500; color: var(--bark); }
  .spot-type { font-size: 0.78rem; color: #9a8878; }

  .new-route-btn {
    width: 100%;
    padding: 0.85rem;
    border-radius: 12px;
    border: 1.5px solid var(--sand);
    background: transparent;
    color: var(--bark);
    font-family: 'DM Sans', sans-serif;
    font-size: 0.9rem;
    cursor: pointer;
    margin-top: 0.75rem;
    transition: all 0.18s;
  }
  .new-route-btn:hover { border-color: var(--bark); background: rgba(61,43,31,0.04); }

  @keyframes fadeDown {
    from { opacity: 0; transform: translateY(-16px); }
    to { opacity: 1; transform: translateY(0); }
  }
  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(16px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .loading-state {
    text-align: center;
    padding: 2rem;
    display: none;
  }
  .walk-anim {
    font-size: 2rem;
    animation: walk 0.6s steps(2) infinite;
  }
  @keyframes walk {
    0% { transform: translateX(-4px); }
    100% { transform: translateX(4px); }
  }
  .loading-text {
    font-family: 'DM Serif Display', serif;
    font-size: 1.1rem;
    color: var(--bark);
    margin-top: 0.75rem;
  }
  .loading-sub {
    font-size: 0.82rem;
    color: #9a8878;
    margin-top: 0.25rem;
  }
</style>
</head>
<body>

<header>
  <div class="logo">Walk <span>Buddy</span></div>
  <div class="tagline">West Hollywood ¬∑ Discover your neighborhood</div>
</header>

<div class="card" id="planner-card">
  <div class="section-label">How far do you want to walk?</div>
  <div class="distance-display" id="dist-display">1.5 <span>miles</span></div>
  <input type="range" id="dist-slider" min="0.5" max="5" step="0.5" value="1.5">
  <div class="range-labels"><span>0.5 mi</span><span>5 mi</span></div>

  <div style="margin-top: 1.5rem;">
    <div class="section-label">What do you want to pass by?</div>
    <div class="prefs-grid">
      <button class="pref-chip" data-pref="park" onclick="togglePref(this)"><span class="icon">üå≥</span> Park</button>
      <button class="pref-chip" data-pref="coffee" onclick="togglePref(this)"><span class="icon">‚òï</span> Coffee</button>
      <button class="pref-chip" data-pref="bookstore" onclick="togglePref(this)"><span class="icon">üìö</span> Bookstore</button>
      <button class="pref-chip" data-pref="shops" onclick="togglePref(this)"><span class="icon">üõçÔ∏è</span> Shops</button>
      <button class="pref-chip" data-pref="restaurant" onclick="togglePref(this)"><span class="icon">üçú</span> Restaurant</button>
      <button class="pref-chip" data-pref="nature" onclick="togglePref(this)"><span class="icon">üåø</span> Nature</button>
      <button class="pref-chip" data-pref="art" onclick="togglePref(this)"><span class="icon">üé®</span> Art / Murals</button>
      <button class="pref-chip" data-pref="quiet" onclick="togglePref(this)"><span class="icon">ü§´</span> Quiet streets</button>
    </div>
  </div>

  <button class="generate-btn" onclick="generateRoute()" id="gen-btn">
    üó∫Ô∏è Generate My Walk
  </button>
</div>

<div class="card loading-state" id="loading-card">
  <div class="walk-anim">üö∂</div>
  <div class="loading-text">Finding your route‚Ä¶</div>
  <div class="loading-sub">Discovering spots along the way</div>
</div>

<div id="map-section">
  <div id="map"></div>
  <div class="route-info" id="route-info"></div>
  <div class="spots-list" id="spots-list"></div>
  <button class="new-route-btn" onclick="resetPlanner()">‚Ü© Plan a different walk</button>
</div>

<script>
// West Hollywood center (fallback)
const WEHOLOCENTER = { lat: 34.0900, lng: -118.3617 };
let userCenter = null; // will be set to GPS location if granted

const selectedPrefs = new Set();

function togglePref(el) {
  const p = el.dataset.pref;
  if (selectedPrefs.has(p)) { selectedPrefs.delete(p); el.classList.remove('active'); }
  else { selectedPrefs.add(p); el.classList.add('active'); }
}

// Slider
const slider = document.getElementById('dist-slider');
const display = document.getElementById('dist-display');
slider.addEventListener('input', () => {
  display.innerHTML = `${slider.value} <span>miles</span>`;
  const pct = ((slider.value - slider.min) / (slider.max - slider.min)) * 100;
  slider.style.setProperty('--pct', pct + '%');
});
// init
slider.style.setProperty('--pct', '22.2%');

// Preference ‚Üí Google Places type mapping
const prefToType = {
  park: 'park',
  coffee: 'cafe',
  bookstore: 'book_store',
  shops: 'clothing_store',
  restaurant: 'restaurant',
  nature: 'park',
  art: 'art_gallery',
  quiet: null
};

const prefEmoji = {
  park: 'üå≥', coffee: '‚òï', bookstore: 'üìö', shops: 'üõçÔ∏è',
  restaurant: 'üçú', nature: 'üåø', art: 'üé®', quiet: 'ü§´'
};

let map, directionsService, directionsRenderer, placesService;

function initMap() {
  map = new google.maps.Map(document.getElementById('map'), {
    center: WEHOLOCENTER,
    zoom: 14,
    styles: [
      { featureType: 'all', elementType: 'geometry', stylers: [{ color: '#f5efe6' }] },
      { featureType: 'road', elementType: 'geometry', stylers: [{ color: '#ede0cc' }] },
      { featureType: 'road.arterial', elementType: 'geometry', stylers: [{ color: '#d4c5a9' }] },
      { featureType: 'water', elementType: 'geometry', stylers: [{ color: '#a8cfe0' }] },
      { featureType: 'poi.park', elementType: 'geometry', stylers: [{ color: '#c8dfc4' }] },
      { featureType: 'poi', elementType: 'labels', stylers: [{ visibility: 'off' }] },
      { featureType: 'transit', stylers: [{ visibility: 'off' }] },
    ],
    disableDefaultUI: true,
    zoomControl: true,
  });
  directionsService = new google.maps.DirectionsService();
  directionsRenderer = new google.maps.DirectionsRenderer({
    polylineOptions: { strokeColor: '#3D2B1F', strokeWeight: 4, strokeOpacity: 0.85 },
    suppressMarkers: false,
  });
  directionsRenderer.setMap(map);
  placesService = new google.maps.places.PlacesService(map);

  // Try to get user's location
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(
      (pos) => {
        userCenter = { lat: pos.coords.latitude, lng: pos.coords.longitude };
        map.setCenter(userCenter);
        document.querySelector('.tagline').textContent = 'Your location ¬∑ Discover your neighborhood';
        // Add a blue dot for current location
        new google.maps.Marker({
          position: userCenter,
          map: map,
          icon: {
            path: google.maps.SymbolPath.CIRCLE,
            scale: 8,
            fillColor: '#7BADC4',
            fillOpacity: 1,
            strokeColor: 'white',
            strokeWeight: 2,
          },
          title: 'You are here',
        });
      },
      () => { /* permission denied, use WeHo fallback */ }
    );
  }
}

async function generateRoute() {
  const miles = parseFloat(slider.value);
  const center = userCenter || WEHOLOCENTER;
  
  document.getElementById('planner-card').style.display = 'none';
  document.getElementById('loading-card').style.display = 'block';
  document.getElementById('map-section').style.display = 'none';

  // Build waypoints from selected prefs
  const waypoints = [];
  const foundSpots = [];

  // Gather place types to search for
  const types = [...selectedPrefs].map(p => prefToType[p]).filter(Boolean);
  const uniqueTypes = [...new Set(types)];

  // For each type, find a nearby place offset from center
  const angles = [0, 90, 180, 270, 45, 135, 225, 315];
  let angleIdx = 0;

  const metersPerMile = 1609.34;
  const radius = (miles / 3) * metersPerMile; // search radius proportional to walk

  await Promise.all(uniqueTypes.slice(0, 3).map((type, i) => {
    return new Promise(resolve => {
      // Offset search center slightly so we get variety
      const angle = (angles[angleIdx++ % angles.length] * Math.PI) / 180;
      const offsetLat = center.lat + (radius / 111320) * 0.5 * Math.sin(angle);
      const offsetLng = center.lng + (radius / (111320 * Math.cos(center.lat * Math.PI / 180))) * 0.5 * Math.cos(angle);

      placesService.nearbySearch({
        location: { lat: offsetLat, lng: offsetLng },
        radius: radius,
        type: type,
      }, (results, status) => {
        if (status === 'OK' && results.length > 0) {
          // Pick a random result from top 5
          const pick = results[Math.floor(Math.random() * Math.min(5, results.length))];
          waypoints.push({
            location: { lat: pick.geometry.location.lat(), lng: pick.geometry.location.lng() },
            stopover: false,
          });
          foundSpots.push({
            name: pick.name,
            type: [...selectedPrefs].find(p => prefToType[p] === type),
            location: pick.geometry.location,
          });
        }
        resolve();
      });
    });
  }));

  // If no prefs selected, add a random offset waypoint to make a loop
  if (waypoints.length === 0) {
    const angle = Math.random() * 2 * Math.PI;
    const d = (miles / 4) * metersPerMile;
    waypoints.push({
      location: {
        lat: center.lat + (d / 111320) * Math.sin(angle),
        lng: center.lng + (d / (111320 * Math.cos(center.lat * Math.PI / 180))) * Math.cos(angle),
      },
      stopover: false,
    });
  }

  // Get directions as a loop
  directionsService.route({
    origin: center,
    destination: center,
    waypoints: waypoints,
    travelMode: 'WALKING',
    optimizeWaypoints: true,
  }, (result, status) => {
    document.getElementById('loading-card').style.display = 'none';

    if (status === 'OK') {
      directionsRenderer.setDirections(result);

      const leg = result.routes[0].legs;
      let totalDist = 0, totalTime = 0;
      leg.forEach(l => { totalDist += l.distance.value; totalTime += l.duration.value; });
      const distMiles = (totalDist / 1609.34).toFixed(1);
      const timeMin = Math.round(totalTime / 60);

      document.getElementById('route-info').innerHTML = `
        <div class="info-pill"><div class="val">${distMiles}</div><div class="lbl">Miles</div></div>
        <div class="info-pill"><div class="val">${timeMin}</div><div class="lbl">Est. Minutes</div></div>
        <div class="info-pill"><div class="val">${Math.round(distMiles * 2000)}</div><div class="lbl">Est. Steps</div></div>
      `;

      if (foundSpots.length > 0) {
        const spotsHTML = foundSpots.map(s => `
          <div class="spot-item">
            <div class="spot-icon">${prefEmoji[s.type] || 'üìç'}</div>
            <div>
              <div class="spot-name">${s.name}</div>
              <div class="spot-type">${s.type ? s.type.charAt(0).toUpperCase() + s.type.slice(1) : 'Point of interest'}</div>
            </div>
          </div>
        `).join('');
        document.getElementById('spots-list').innerHTML = `
          <div class="spots-title">Along your route</div>
          ${spotsHTML}
        `;
        document.getElementById('spots-list').style.display = 'block';
      } else {
        document.getElementById('spots-list').style.display = 'none';
      }

      document.getElementById('map-section').style.display = 'block';
    } else {
      // Fallback: just show map centered on WeHo
      document.getElementById('map-section').style.display = 'block';
      document.getElementById('route-info').innerHTML = `<div class="info-pill" style="flex:1"><div class="val">üó∫Ô∏è</div><div class="lbl">Route unavailable ‚Äî try different prefs</div></div>`;
      document.getElementById('spots-list').style.display = 'none';
    }
  });
}

function resetPlanner() {
  document.getElementById('map-section').style.display = 'none';
  document.getElementById('planner-card').style.display = 'block';
}
</script>

<!-- NOTE: Replace AIzaSyBKN2rvj8IgcdbZlkvRui36fpDnwZFA8XM with a real Google Maps API key with Maps JS + Places + Directions APIs enabled -->
<script async defer
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBKN2rvj8IgcdbZlkvRui36fpDnwZFA8XM&libraries=places&callback=initMap">
</script>

</body>
</html>
